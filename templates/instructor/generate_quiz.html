{% extends "base.html" %}

{% block title %}Generate Quiz - Adaptive Quiz Generator{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{{ url_for('instructor.index') }}">Instructor</a></li>
                <li class="breadcrumb-item"><a href="{{ url_for('instructor.view_document', doc_id=document.id) }}">{{ document.filename }}</a></li>
                <li class="breadcrumb-item active">Generate Quiz</li>
            </ol>
        </nav>
        <h1><i class="bi bi-magic"></i> Generate Quiz</h1>
        <p class="text-muted">Configure and generate an AI-powered quiz from "{{ document.filename }}"</p>
    </div>
</div>

<div class="row">
    <div class="col-lg-8">
        <div class="card shadow">
            <div class="card-body p-4">
                <form method="POST" action="{{ url_for('instructor.generate_quiz', doc_id=document.id) }}" id="generateForm">
                    
                    <!-- Quiz Name -->
                    <div class="mb-4">
                        <label for="quiz_name" class="form-label">Quiz Name</label>
                        <input type="text" class="form-control form-control-lg" id="quiz_name" 
                               name="quiz_name" placeholder="e.g., Chapter 3 - Search Algorithms" required>
                    </div>
                    
                    <!-- Number of Questions -->
                    <div class="mb-4">
                        <label for="num_questions" class="form-label">Number of Questions</label>
                        <input type="range" class="form-range" id="num_questions" name="num_questions" 
                               min="5" max="30" value="10" oninput="updateQuestionCount(this.value)">
                        <div class="d-flex justify-content-between">
                            <span class="text-muted">5</span>
                            <strong id="questionCountDisplay">10 questions</strong>
                            <span class="text-muted">30</span>
                        </div>
                    </div>
                    
                    <!-- Question Types -->
                    <div class="mb-4">
                        <label class="form-label">Question Types</label>
                        <div class="d-flex gap-3 flex-wrap">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="question_types" 
                                       value="mcq" id="type_mcq" checked>
                                <label class="form-check-label" for="type_mcq">
                                    <i class="bi bi-list-ol"></i> Multiple Choice
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="question_types" 
                                       value="true_false" id="type_tf" checked>
                                <label class="form-check-label" for="type_tf">
                                    <i class="bi bi-toggle-on"></i> True/False
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="question_types" 
                                       value="short_answer" id="type_sa">
                                <label class="form-check-label" for="type_sa">
                                    <i class="bi bi-pencil"></i> Short Answer
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Difficulty -->
                    <div class="mb-4">
                        <label class="form-label">Difficulty Level</label>
                        <div class="btn-group w-100" role="group">
                            <input type="radio" class="btn-check" name="difficulty" id="diff_easy" value="easy">
                            <label class="btn btn-outline-success" for="diff_easy">
                                <i class="bi bi-emoji-smile"></i> Easy
                            </label>
                            
                            <input type="radio" class="btn-check" name="difficulty" id="diff_medium" value="medium">
                            <label class="btn btn-outline-warning" for="diff_medium">
                                <i class="bi bi-emoji-neutral"></i> Medium
                            </label>
                            
                            <input type="radio" class="btn-check" name="difficulty" id="diff_hard" value="hard">
                            <label class="btn btn-outline-danger" for="diff_hard">
                                <i class="bi bi-emoji-angry"></i> Hard
                            </label>
                            
                            <input type="radio" class="btn-check" name="difficulty" id="diff_mixed" value="mixed" checked>
                            <label class="btn btn-outline-primary" for="diff_mixed">
                                <i class="bi bi-shuffle"></i> Mixed
                            </label>
                        </div>
                    </div>
                    
                    <!-- Adaptive Mode -->
                    <div class="mb-4">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="is_adaptive" 
                                   name="is_adaptive" checked>
                            <label class="form-check-label" for="is_adaptive">
                                <strong>Adaptive Mode</strong>
                                <br>
                                <small class="text-muted">Questions adapt based on student's weak concepts using Multi-Armed Bandits</small>
                            </label>
                        </div>
                    </div>
                    
                    <!-- Password Protection -->
                    <div class="mb-4">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="is_password_protected" 
                                   name="is_password_protected" onchange="togglePasswordField()">
                            <label class="form-check-label" for="is_password_protected">
                                <strong>Password Protected</strong>
                                <br>
                                <small class="text-muted">Require password to access the quiz</small>
                            </label>
                        </div>
                        <div class="mt-2 d-none" id="passwordField">
                            <input type="text" class="form-control" name="password" 
                                   placeholder="Enter quiz password">
                        </div>
                    </div>
                    
                    <hr>
                    
                    <!-- Submit -->
                    <button type="submit" class="btn btn-success btn-lg w-100" id="generateBtn">
                        <i class="bi bi-magic"></i> Generate Quiz
                    </button>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Document Summary -->
    <div class="col-lg-4">
        <div class="card">
            <div class="card-header bg-white">
                <h5 class="mb-0"><i class="bi bi-file-earmark-text"></i> Document Summary</h5>
            </div>
            <div class="card-body">
                <p><strong>File:</strong> {{ document.filename }}</p>
                <p><strong>Concepts:</strong> {{ document.concepts|length if document.concepts else 0 }}</p>
                
                {% if document.concepts %}
                <h6 class="mt-3">Top Concepts:</h6>
                <div class="d-flex flex-wrap gap-1">
                    {% for concept in document.concepts[:10] %}
                    <span class="badge bg-light text-dark">{{ concept.name if concept.name else concept }}</span>
                    {% endfor %}
                    {% if document.concepts|length > 10 %}
                    <span class="badge bg-secondary">+{{ document.concepts|length - 10 }} more</span>
                    {% endif %}
                </div>
                {% endif %}
            </div>
        </div>
        
        <div class="card mt-3">
            <div class="card-body">
                <h6><i class="bi bi-lightbulb text-warning"></i> Tips</h6>
                <ul class="small text-muted mb-0">
                    <li>Start with 10-15 questions for a 15-minute quiz</li>
                    <li>Mix question types for variety</li>
                    <li>Enable adaptive mode for personalized learning</li>
                    <li>Use password protection for graded assessments</li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function updateQuestionCount(value) {
    document.getElementById('questionCountDisplay').textContent = value + ' questions';
}

function togglePasswordField() {
    const checkbox = document.getElementById('is_password_protected');
    const field = document.getElementById('passwordField');
    
    if (checkbox.checked) {
        field.classList.remove('d-none');
    } else {
        field.classList.add('d-none');
    }
}

// Form validation and submit
document.getElementById('generateForm').addEventListener('submit', function(e) {
    // Check if at least one question type is selected
    const checkboxes = document.querySelectorAll('input[name="question_types"]:checked');
    
    if (checkboxes.length === 0) {
        e.preventDefault();
        alert('Please select at least one question type.');
        return false;
    }
    
    // Show loading state on form submit
    const btn = document.getElementById('generateBtn');
    btn.disabled = true;
    btn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Generating questions...';
});
</script>
{% endblock %}
